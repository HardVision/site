<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/redefinirSenha.css" />
  <title>Verificar Token</title>
</head>

<body style="background-color: #01303F;">
  <a href="index.html">
    <img src="assets/logo.png" alt="Logo desktop" class="fixed-logo desktop-logo">
    <img src="assets/Rectangle 51.png" alt="Logo mobile" class="fixed-logo mobile-logo">
  </a>

  <div class="container-pai">
    <!-- Coluna Esquerda -->
    <div class="bemVindo">
      <h2>Bem-vindo(a)!</h2>
      <div class="line white"></div>
      <div class="line blue"></div>
      <div class="line light-blue"></div>
    </div>

    <!-- Coluna Direita -->
    <div class="login-container atualizadaS">
      <h2 style="color: #01303F; font-weight: 900;">Verificação de Token</h2>
      <p>Insira o token que foi enviado para o seu e-mail.</p>

      <div class="form-group">
        <img src="assets/key-solid-full.svg" alt="ícone token">
        <input type="text" id="tokenInput" name="tokenInput" required placeholder=" ">
        <label for="tokenInput">Código de Verificação</label>
      </div>

      <button onclick="verificarToken()">Verificar</button>
      <button onclick="atualizarToken()">Reenviar token</button>


      <p class="cadastro"><a href="recuperarSenha.html">Voltar</a></p>
    
    </div>
  </div>

  <!-- Alerta -->
  <div class="alerta">
    <div class="alerta-icone" id="alertaIcone">
      <img src="assets/alert.svg" alt="Alerta" id="alertaImg" />
    </div>
    <p class="alerta-texto" id="alertaTxt"></p>
  </div>
</body>

</html>

<script>



  function mostrarAlerta(msg, tipo = "padrao") {
    const alerta = document.querySelector(".alerta");
    const alertaImg = document.getElementById("alertaImg");
    const alertaTxt = document.getElementById("alertaTxt");

    alerta.classList.remove("sucesso", "erro");

    if (tipo === "sucesso") alerta.classList.add("sucesso");
    if (tipo === "erro") alerta.classList.add("erro");

    alertaTxt.innerText = msg;
    alerta.style.display = "flex";
    alerta.classList.add("mostrar");

    setTimeout(() => {
      alerta.classList.remove("mostrar");
      setTimeout(() => (alerta.style.display = "none"), 500);
    }, 4000);
  }

  async function verificarToken() {
    const token = document.getElementById("tokenInput").value.trim();
    const email = localStorage.getItem("emailRecuperacao");

    if (!token) {
      mostrarAlerta("Por favor, insira o token.", "erro");
      return;
    }

    if (!email) {
      mostrarAlerta("E-mail de recuperação não encontrado. Refaça o processo.", "erro");
      return;
    }

    try {
      const res = await fetch("/redefinirSenhas/verificarToken", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ emailServer: email, tokenServer: token })
      });

      if (res.ok) {
        mostrarAlerta("Token verificado com sucesso!", "sucesso");
        localStorage.setItem("tokenVerificado", "true");

        setTimeout(() => {
          window.location.href = "redefinirSenha.html";
        }, 2000);
      } else {
        const texto = await res.text();
        mostrarAlerta(texto || "Token inválido ou expirado.", "erro");
      }
    } catch (erro) {
      console.error(erro);
      mostrarAlerta("Erro de conexão com o servidor.", "erro");
    }
  }
</script>
<script src="js/emailFront.js"></script>
